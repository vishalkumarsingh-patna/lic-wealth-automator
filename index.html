<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wealth & Protection Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #003366;
            --secondary: #00509d;
            --accent: #ffcc00;
            --growth: #28a745;
            --alert: #d32f2f;
        }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background-color: #f0f2f5; 
            margin: 0; 
            padding: 20px;
        }
        
        .bill-card {
            max-width: 210mm; /* A4 Width */
            margin: auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 25px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 40px;
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .photo-container {
            width: 80px; height: 100px; border: 3px solid white; border-radius: 4px;
            overflow: hidden; flex-shrink: 0; background: white; display: flex; align-items: center; justify-content: center; color: #333;
        }
        .photo-container img { width: 100%; height: 100%; object-fit: cover; }

        .payment-status {
            background: #fff9c4;
            padding: 15px 40px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .highlight-box {
            background: var(--alert);
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 12px;
        }

        .content { padding: 25px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f1f5f9; color: var(--primary); padding: 12px; text-align: left; font-size: 11px; text-transform: uppercase; }
        td { padding: 8px 12px; border-bottom: 1px solid #eee; font-size: 11px; color: #333; }
        
        td:first-child::before {
            content: "â€¢ ";
            color: var(--secondary);
            font-weight: bold;
        }

        .total-row { background: #f8f9fa; font-weight: bold; }
        .balance-row { background: #fffde7; font-size: 16px; color: var(--alert); font-weight: bold; border-top: 2px solid var(--accent); }

        .motivation-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; padding: 0 25px 25px;
        }

        .m-card { padding: 12px; border-radius: 10px; font-size: 10px; line-height: 1.4; border: 1px solid #e0e0e0; }
        .m-card h4 { margin: 0 0 5px 0; color: var(--primary); font-size: 11px; }

        .footer-grid {
            display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px;
            padding: 15px 25px; background: #fafafa; border-top: 1px solid #eee;
        }

        .pay-btn {
            display: block; background: var(--growth); color: white; padding: 10px;
            border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: bold; text-align: center;
            margin-top: 10px;
        }

        /* Loading Spinner */
        .loading { text-align: center; padding: 20px; color: var(--secondary); }

    </style>
</head>
<body>

<div class="bill-card">
    <div class="header">
        <div class="photo-container">
            <img src="img_vishal.jpg" onerror="this.src='https://via.placeholder.com/100x125?text=Profile'" alt="Profile">
        </div>
        <div class="header-text">
            <h1 style="margin:0; font-size: 22px;">Wealth & Protection Dashboard</h1>
            <p style="margin:5px 0; font-size: 14px;">Vishal Kumar Singh | Portfolio Manager</p>
            <div style="font-size: 10px; opacity: 0.8;">Auth ID: 9934291260 | Patna, Bihar</div>
        </div>
    </div>

    <div class="payment-status">
        <div>
            <strong>Latest Payment Received:</strong> <span style="color: var(--growth); font-size: 16px;" id="last-paid-amount">â‚¹0.00</span>
        </div>
        <div class="highlight-box">
            NEXT DUE DATE CHECK
        </div>
    </div>

    <div class="content">
        <table>
            <thead>
                <tr>
                    <th>Policy Holder</th>
                    <th>Policy Number</th>
                    <th>Mode</th>
                    <th>Premium</th>
                    <th>Next Due</th>
                </tr>
            </thead>
            <tbody id="bill-table-body">
                <tr><td colspan="5" class="loading">Fetching data from Secure Database...</td></tr>
            </tbody>
            <tfoot id="bill-table-foot">
                </tfoot>
        </table>
    </div>

    <div class="motivation-grid">
        <div class="m-card" style="background: #fdf2f2; border-left: 4px solid #d32f2f;">
            <h4>ðŸ§  Money Discipline</h4>
            Your mind is like a muscle. Paying today shows you have the <strong>discipline of the 1%</strong>.
        </div>
        <div class="m-card" style="background: #f0fdf4; border-left: 4px solid #16a34a;">
            <h4>ðŸŒ± Seed of Growth</h4>
            Every â‚¹100 saved is a seed for a tree that shades your children.
        </div>
        <div class="m-card" style="background: #eff6ff; border-left: 4px solid #2563eb;">
            <h4>ðŸŽ“ Child Education</h4>
            These payments ensure that when your children are ready for university, their **financial wings** are built.
        </div>
    </div>

    <div class="footer-grid">
        <div style="font-size: 11px; line-height: 1.5;">
            <strong style="color: var(--primary);">ðŸ“Š Remaining Strategy:</strong>
            <p style="margin:5px 0;">Maintaining this timeline keeps your 100% bonus eligibility intact.</p>
        </div>

        <div class="qr-box" style="text-align: center; border: 1px solid #ddd; padding: 10px; border-radius: 8px;">
            <div style="font-size: 9px; font-weight: bold; margin-bottom: 5px;">SCAN TO PAY BALANCE</div>
            <img src="qr.jpeg" onerror="this.style.display='none'" alt="QR" style="width: 80px; height: 80px; object-fit: contain;">
            <a href="#" class="pay-btn">PAY BALANCE</a>
        </div>
    </div>
</div>

<script>
    async function fetchBills() {
        try {
            // Add timestamp to avoid caching
            const response = await fetch('lic_data.json?' + new Date().getTime());
            if (!response.ok) throw new Error("Data not found");
            
            const data = await response.json();
            const tbody = document.getElementById('bill-table-body');
            const tfoot = document.getElementById('bill-table-foot');
            tbody.innerHTML = '';
            
            let totalPremium = 0;

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">No bills found yet. Send a test email!</td></tr>';
                return;
            }

            // Create Rows
            data.forEach(item => {
                // Remove commas and symbols for calculation
                let amountStr = String(item.premium_amount).replace(/[â‚¹,]/g, '');
                let amount = parseFloat(amountStr) || 0;
                totalPremium += amount;

                const row = `
                    <tr>
                        <td>${item.policy_holder_name || 'Valued Client'}</td>
                        <td>${item.policy_number}</td>
                        <td>${item.mode || 'N/A'}</td>
                        <td>â‚¹${amount.toLocaleString('en-IN')}</td>
                        <td style="color:var(--alert); font-weight:bold;">${item.next_due_date || 'Pending'}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Update Totals
            tfoot.innerHTML = `
                <tr class="total-row">
                    <td colspan="3" style="text-align: right;">Gross Portfolio Total:</td>
                    <td colspan="2">â‚¹${totalPremium.toLocaleString('en-IN')}</td>
                </tr>
                <tr class="balance-row">
                    <td colspan="3" style="text-align: right;">TOTAL OUTSTANDING:</td>
                    <td colspan="2">â‚¹${totalPremium.toLocaleString('en-IN')}</td>
                </tr>
            `;

            // Update Top Card (Last paid amount roughly matches the first bill found)
            if(data.length > 0) {
                 let firstAmount = String(data[0].premium_amount).replace(/[â‚¹,]/g, '');
                 document.getElementById('last-paid-amount').innerText = "â‚¹" + parseFloat(firstAmount).toLocaleString('en-IN');
            }

        } catch (error) {
            console.error(error);
            document.getElementById('bill-table-body').innerHTML = '<tr><td colspan="5" style="text-align:center; color:red;">Error loading data. Check console.</td></tr>';
        }
    }

    fetchBills();
</script>

</body>
</html>
